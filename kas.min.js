window.KAS={},function(t){var e=function(){function t(){this.yy={}}var e=function(t,e,n,i){for(n=n||{},i=t.length;i--;n[t[i]]=e);return n},n=[1,7],i=[1,17],r=[1,13],s=[1,14],a=[1,15],o=[1,32],c=[1,22],u=[1,23],h=[1,24],l=[1,25],f=[1,26],p=[1,33],y=[1,27],d=[1,28],m=[1,29],g=[1,30],v=[1,20],x=[1,36],_=[1,37],w=[5,6,8,10,33,35,41,43,45],b=[1,39],k=[1,40],M=[5,6,8,10,12,14,16,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],I=[10,16,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],S=[5,6,8,10,12,14,16,18,19,21,22,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],E={trace:function(){},yy:{},symbols_:{error:2,equation:3,expression:4,SIGN:5,EOF:6,additive:7,"+":8,multiplicative:9,"-":10,triglog:11,"*":12,negative:13,"/":14,trig:15,TRIG:16,trigfunc:17,"^":18,TRIGINV:19,logbase:20,ln:21,log:22,_:23,subscriptable:24,power:25,primitive:26,variable:27,VAR:28,CONST:29,INT:30,FLOAT:31,"{":32,"}":33,"(":34,")":35,"function":36,FUNC:37,invocation:38,sqrt:39,"[":40,"]":41,abs:42,"|":43,"LEFT|":44,"RIGHT|":45,FRAC:46,$accept:0,$end:1},terminals_:{2:"error",5:"SIGN",6:"EOF",8:"+",10:"-",12:"*",14:"/",16:"TRIG",18:"^",19:"TRIGINV",21:"ln",22:"log",23:"_",28:"VAR",29:"CONST",30:"INT",31:"FLOAT",32:"{",33:"}",34:"(",35:")",37:"FUNC",39:"sqrt",40:"[",41:"]",42:"abs",43:"|",44:"LEFT|",45:"RIGHT|",46:"FRAC"},productions_:[0,[3,4],[3,2],[3,1],[4,1],[7,3],[7,3],[7,1],[9,2],[9,3],[9,3],[9,1],[13,2],[13,1],[15,1],[17,1],[17,3],[17,1],[20,1],[20,1],[20,3],[11,2],[11,2],[11,1],[25,3],[25,1],[27,1],[24,3],[24,1],[24,1],[24,1],[24,1],[24,3],[24,3],[36,1],[38,4],[38,4],[38,7],[38,4],[38,3],[38,3],[38,4],[26,1],[26,1],[26,7]],performAction:function(t,e,n,i,r,s,a){var o=s.length-1;switch(r){case 1:return new i.Eq(s[o-3],s[o-2],s[o-1]);case 2:return s[o-1];case 3:return new i.Add([]);case 4:case 7:case 11:case 13:case 15:case 20:case 23:case 25:case 42:case 43:this.$=s[o];break;case 5:this.$=i.Add.createOrAppend(s[o-2],s[o]);break;case 6:this.$=i.Add.createOrAppend(s[o-2],i.Mul.handleNegative(s[o],"subtract"));break;case 8:this.$=i.Mul.fold(i.Mul.createOrAppend(s[o-1],s[o]));break;case 9:this.$=i.Mul.fold(i.Mul.createOrAppend(s[o-2],s[o]));break;case 10:this.$=i.Mul.fold(i.Mul.handleDivide(s[o-2],s[o]));break;case 12:this.$=i.Mul.handleNegative(s[o]);break;case 14:case 17:this.$=[t];break;case 16:this.$=s[o-2].concat(s[o]);break;case 18:this.$=i.Log.natural();break;case 19:this.$=i.Log.common();break;case 21:this.$=i.Trig.create(s[o-1],s[o]);break;case 22:this.$=i.Log.create(s[o-1],s[o]);break;case 24:this.$=new i.Pow(s[o-2],s[o]);break;case 26:case 34:this.$=t;break;case 27:this.$=new i.Var(s[o-2],s[o]);break;case 28:this.$=new i.Var(s[o]);break;case 29:this.$=new i.Const(t.toLowerCase());break;case 30:this.$=i.Int.create(Number(t));break;case 31:this.$=i.Float.create(Number(t));break;case 32:this.$=s[o-1].completeParse();break;case 33:this.$=s[o-1].completeParse().addHint("parens");break;case 35:case 36:this.$=i.Pow.sqrt(s[o-1]);break;case 37:this.$=new i.Pow.nthroot(s[o-1],s[o-4]);break;case 38:case 39:case 40:this.$=new i.Abs(s[o-1]);break;case 41:this.$=new i.Func(s[o-3],s[o-1]);break;case 44:this.$=i.Mul.handleDivide(s[o-4],s[o-1])}},table:[{3:1,4:2,6:[1,3],7:4,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{1:[3]},{5:[1,34],6:[1,35]},{1:[2,3]},e([5,6],[2,4],{8:x,10:_}),e(w,[2,7],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:b,14:k,16:i,19:r,21:s,22:a,28:o,29:c,30:u,31:h,32:l,34:f,37:p,39:y,42:d,44:g,46:v}),e(M,[2,11]),{10:n,11:8,13:41,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},e(M,[2,13]),{10:n,11:8,13:42,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{10:n,11:8,13:43,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},e(M,[2,23]),e(I,[2,15],{18:[1,44]}),e(I,[2,17]),e(I,[2,18]),e(I,[2,19],{23:[1,45]}),e(M,[2,25],{18:[1,46]}),e([10,16,18,19,21,22,28,29,30,31,32,34,37,39,42,43,44,46],[2,14]),e(S,[2,42]),e(S,[2,43]),{32:[1,47]},e(S,[2,28],{23:[1,48]}),e(S,[2,29]),e(S,[2,30]),e(S,[2,31]),{7:49,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:50,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{32:[1,52],34:[1,51],40:[1,53]},{34:[1,54]},{7:55,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:56,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{34:[1,57]},e([5,6,8,10,12,14,16,18,19,21,22,23,28,29,30,31,32,33,34,35,37,39,41,42,43,44,45,46],[2,26]),{34:[2,34]},{4:58,7:4,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{1:[2,2]},{9:59,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{9:60,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},e(M,[2,8]),{10:n,11:8,13:61,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{10:n,11:8,13:62,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},e(M,[2,12]),e(M,[2,21]),e(M,[2,22]),{10:n,11:8,13:63,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{24:64,27:21,28:o,29:c,30:u,31:h,32:l,34:f},{10:n,11:8,13:65,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:66,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{24:67,27:21,28:o,29:c,30:u,31:h,32:l,34:f},{8:x,10:_,33:[1,68]},{8:x,10:_,35:[1,69]},{7:70,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:71,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:72,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:73,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{8:x,10:_,43:[1,74]},{8:x,10:_,45:[1,75]},{7:76,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{6:[1,77]},e(w,[2,5],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:b,14:k,16:i,19:r,21:s,22:a,28:o,29:c,30:u,31:h,32:l,34:f,37:p,39:y,42:d,44:g,46:v}),e(w,[2,6],{17:9,20:10,25:11,15:12,26:16,24:18,38:19,27:21,36:31,11:38,12:b,14:k,16:i,19:r,21:s,22:a,28:o,29:c,30:u,31:h,32:l,34:f,37:p,39:y,42:d,44:g,46:v}),e(M,[2,9]),e(M,[2,10]),e(I,[2,16]),e(I,[2,20]),e(M,[2,24]),{8:x,10:_,33:[1,78]},e(S,[2,27]),e(S,[2,32]),e(S,[2,33]),{8:x,10:_,35:[1,79]},{8:x,10:_,33:[1,80]},{8:x,10:_,41:[1,81]},{8:x,10:_,35:[1,82]},e(S,[2,39]),e(S,[2,40]),{8:x,10:_,35:[1,83]},{1:[2,1]},{32:[1,84]},e(S,[2,35]),e(S,[2,36]),{32:[1,85]},e(S,[2,38]),e(S,[2,41]),{7:86,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{7:87,9:5,10:n,11:8,13:6,15:12,16:i,17:9,19:r,20:10,21:s,22:a,24:18,25:11,26:16,27:21,28:o,29:c,30:u,31:h,32:l,34:f,36:31,37:p,38:19,39:y,42:d,43:m,44:g,46:v},{8:x,10:_,33:[1,88]},{8:x,10:_,33:[1,89]},e(S,[2,44]),e(S,[2,37])],defaultActions:{3:[2,3],33:[2,34],35:[2,2],77:[2,1]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){function e(){var t;return t=y.lex()||f,"number"!=typeof t&&(t=n.symbols_[t]||t),t}var n=this,i=[0],r=[null],s=[],a=this.table,o="",c=0,u=0,h=0,l=2,f=1,p=s.slice.call(arguments,1),y=Object.create(this.lexer),d={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(d.yy[m]=this.yy[m]);y.setInput(t,d.yy),d.yy.lexer=y,d.yy.parser=this,"undefined"==typeof y.yylloc&&(y.yylloc={});var g=y.yylloc;s.push(g);var v=y.options&&y.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var x,_,w,b,k,M,I,S,E,A={};;){if(w=i[i.length-1],this.defaultActions[w]?b=this.defaultActions[w]:((null===x||"undefined"==typeof x)&&(x=e()),b=a[w]&&a[w][x]),"undefined"==typeof b||!b.length||!b[0]){var N="";E=[];for(M in a[w])this.terminals_[M]&&M>l&&E.push("'"+this.terminals_[M]+"'");N=y.showPosition?"Parse error on line "+(c+1)+":\n"+y.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[x]||x)+"'":"Parse error on line "+(c+1)+": Unexpected "+(x==f?"end of input":"'"+(this.terminals_[x]||x)+"'"),this.parseError(N,{text:y.match,token:this.terminals_[x]||x,line:y.yylineno,loc:g,expected:E})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+w+", token: "+x);switch(b[0]){case 1:i.push(x),r.push(y.yytext),s.push(y.yylloc),i.push(b[1]),x=null,_?(x=_,_=null):(u=y.yyleng,o=y.yytext,c=y.yylineno,g=y.yylloc,h>0&&h--);break;case 2:if(I=this.productions_[b[1]][1],A.$=r[r.length-I],A._$={first_line:s[s.length-(I||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(I||1)].first_column,last_column:s[s.length-1].last_column},v&&(A._$.range=[s[s.length-(I||1)].range[0],s[s.length-1].range[1]]),k=this.performAction.apply(A,[o,u,c,d.yy,b[1],r,s].concat(p)),"undefined"!=typeof k)return k;I&&(i=i.slice(0,-1*I*2),r=r.slice(0,-1*I),s=s.slice(0,-1*I)),i.push(this.productions_[b[1]][0]),r.push(A.$),s.push(A._$),S=a[i[i.length-2]][i[i.length-1]],i.push(S);break;case 3:return!0}}return!0}},A=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=t[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var s in r)this[s]=r[s];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length;s++)if(n=this._input.match(this.rules[r[s]]),n&&(!e||n[0].length>e[0].length)){if(e=n,i=s,this.options.backtrack_lexer){if(t=this.test_match(n,r[s]),t!==!1)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,r[i]),t!==!1?t:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(t,e,n,i){switch(n){case 0:break;case 1:break;case 2:break;case 3:return"INT";case 4:return"FLOAT";case 5:return"^";case 6:return"*";case 7:return"*";case 8:return"*";case 9:return"*";case 10:return"/";case 11:return"/";case 12:return"-";case 13:return"-";case 14:return"+";case 15:return"^";case 16:return"(";case 17:return")";case 18:return"(";case 19:return")";case 20:return"[";case 21:return"]";case 22:return"{";case 23:return"}";case 24:return"{";case 25:return"}";case 26:return"_";case 27:return"|";case 28:return"LEFT|";case 29:return"RIGHT|";case 30:return"!";case 31:return"SIGN";case 32:return e.yytext="<=","SIGN";case 33:return e.yytext=">=","SIGN";case 34:return e.yytext="<=","SIGN";case 35:return e.yytext=">=","SIGN";case 36:return e.yytext="<>","SIGN";case 37:return e.yytext="<>","SIGN";case 38:return e.yytext="<>","SIGN";case 39:return e.yytext="<>","SIGN";case 40:return e.yytext="<=","SIGN";case 41:return e.yytext=">=","SIGN";case 42:return"FRAC";case 43:return"FRAC";case 44:return"sqrt";case 45:return"abs";case 46:return"ln";case 47:return"log";case 48:return"TRIG";case 49:return"TRIG";case 50:return"TRIG";case 51:return"TRIG";case 52:return e.yytext="sin","TRIG";case 53:return e.yytext="cos","TRIG";case 54:return e.yytext="tan","TRIG";case 55:return e.yytext="csc","TRIG";case 56:return e.yytext="sec","TRIG";case 57:return e.yytext="cot","TRIG";case 58:return e.yytext="arcsin","TRIG";case 59:return e.yytext="arccos","TRIG";case 60:return e.yytext="arctan","TRIG";case 61:return e.yytext="arccsc","TRIG";case 62:return e.yytext="arcsec","TRIG";case 63:return e.yytext="arccot","TRIG";case 64:return"TRIGINV";case 65:return"TRIGINV";case 66:return e.yytext="sinh","TRIG";case 67:return e.yytext="cosh","TRIG";case 68:return e.yytext="tanh","TRIG";case 69:return e.yytext="csch","TRIG";case 70:return e.yytext="sech","TRIG";case 71:return e.yytext="tanh","TRIG";case 72:return"CONST";case 73:return e.yytext="pi","CONST";case 74:return e.yytext="pi","CONST";case 75:return"VAR";case 76:return e.yytext="theta","VAR";case 77:return e.yytext="theta","VAR";case 78:return"VAR";case 79:return e.yytext="phi","VAR";case 80:return e.yytext="phi","VAR";case 81:return t.symbolLexer(e.yytext);case 82:return"EOF";case 83:return"INVALID";case 84:console.log(e.yytext)}},rules:[/^(?:\s+)/,/^(?:\\space)/,/^(?:\\ )/,/^(?:[0-9]+\.?)/,/^(?:([0-9]+)?\.[0-9]+)/,/^(?:\*\*)/,/^(?:\*)/,/^(?:\\cdot|·)/,/^(?:\\times|×)/,/^(?:\\ast)/,/^(?:\/)/,/^(?:\\div|÷)/,/^(?:-)/,/^(?:−)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:\\left\()/,/^(?:\\right\))/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?:\\left\{)/,/^(?:\\right\})/,/^(?:_)/,/^(?:\|)/,/^(?:\\left\|)/,/^(?:\\right\|)/,/^(?:\!)/,/^(?:<=|>=|<>|<|>|=)/,/^(?:\\le)/,/^(?:\\ge)/,/^(?:\\leq)/,/^(?:\\geq)/,/^(?:=\/=)/,/^(?:\\ne)/,/^(?:\\neq)/,/^(?:≠)/,/^(?:≤)/,/^(?:≥)/,/^(?:\\frac)/,/^(?:\\dfrac)/,/^(?:sqrt|\\sqrt)/,/^(?:abs|\\abs)/,/^(?:ln|\\ln)/,/^(?:log|\\log)/,/^(?:sin|cos|tan)/,/^(?:csc|sec|cot)/,/^(?:sinh|cosh|tanh)/,/^(?:csch|sech|coth)/,/^(?:\\sin)/,/^(?:\\cos)/,/^(?:\\tan)/,/^(?:\\csc)/,/^(?:\\sec)/,/^(?:\\cot)/,/^(?:\\arcsin)/,/^(?:\\arccos)/,/^(?:\\arctan)/,/^(?:\\arccsc)/,/^(?:\\arcsec)/,/^(?:\\arccot)/,/^(?:arcsin|arccos|arctan)/,/^(?:arccsc|arcsec|arccot)/,/^(?:\\sinh)/,/^(?:\\cosh)/,/^(?:\\tanh)/,/^(?:\\csch)/,/^(?:\\sech)/,/^(?:\\coth)/,/^(?:pi)/,/^(?:π)/,/^(?:\\pi)/,/^(?:theta)/,/^(?:θ)/,/^(?:\\theta)/,/^(?:phi)/,/^(?:φ)/,/^(?:\\phi)/,/^(?:[a-zA-Z])/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84],inclusive:!0}}};return t}();return E.lexer=A,t.prototype=E,E.Parser=t,new t}();t.parser=e}(KAS),function(t){var e=function(){function t(){this.yy={}}var e=function(t,e,n,i){for(n=n||{},i=t.length;i--;n[t[i]]=e);return n},n=[1,11],i=[1,9],r=[8,17],s=[6,11],a=[6,11,13,17],o={trace:function(){},yy:{},symbols_:{error:2,unitvalue:3,magnitude:4,unit:5,EOF:6,"float":7,POW:8,"int":9,multatoms:10,DIV:11,expatom:12,MUL:13,atom:14,"^":15,nat:16,ATOM:17,FLOAT:18,NAT:19,NEG:20,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",8:"POW",11:"DIV",13:"MUL",15:"^",17:"ATOM",18:"FLOAT",19:"NAT",20:"NEG"},productions_:[0,[3,3],[3,2],[4,3],[4,1],[5,3],[5,1],[10,3],[10,2],[10,1],[12,3],[12,1],[14,1],[7,1],[7,1],[16,1],[9,2],[9,1]],performAction:function(t,e,n,i,r,s,a){var o=s.length-1;switch(r){case 1:return{type:"unitMagnitude",magnitude:s[o-2],unit:s[o-1]};case 2:return{type:"unitStandalone",unit:s[o-1]};case 3:this.$=s[o-2]+"e"+s[o];break;case 4:case 13:case 14:case 15:case 17:this.$=s[o];break;case 5:this.$={num:s[o-2],denom:s[o]};break;case 6:this.$={num:s[o],denom:null};break;case 7:this.$=[s[o-2]].concat(s[o]);break;case 8:this.$=[s[o-1]].concat(s[o]);break;case 9:this.$=[s[o]];break;case 10:this.$={name:s[o-2],pow:s[o]};break;case 11:this.$={name:s[o],pow:1};break;case 12:this.$=t;break;case 16:this.$="-"+s[o]}},table:[{3:1,4:2,5:3,7:4,10:5,12:8,14:10,16:7,17:n,18:[1,6],19:i},{1:[3]},{5:12,10:5,12:8,14:10,17:n},{6:[1,13]},{8:[1,14],17:[2,4]},{6:[2,6],11:[1,15]},e(r,[2,13]),e(r,[2,14]),e(s,[2,9],{12:8,14:10,10:17,13:[1,16],17:n}),e([6,8,11,13,17],[2,15]),e(a,[2,11],{15:[1,18]}),e([6,11,13,15,17],[2,12]),{6:[1,19]},{1:[2,2]},{9:20,19:[1,22],20:[1,21]},{10:23,12:8,14:10,17:n},{10:24,12:8,14:10,17:n},e(s,[2,8]),{16:25,19:i},{1:[2,1]},{17:[2,3]},{19:[1,26]},{17:[2,17]},{6:[2,5]},e(s,[2,7]),e(a,[2,10]),{17:[2,16]}],defaultActions:{13:[2,2],19:[2,1],20:[2,3],22:[2,17],23:[2,5],26:[2,16]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){function e(){var t;return t=y.lex()||f,"number"!=typeof t&&(t=n.symbols_[t]||t),t}var n=this,i=[0],r=[null],s=[],a=this.table,o="",c=0,u=0,h=0,l=2,f=1,p=s.slice.call(arguments,1),y=Object.create(this.lexer),d={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(d.yy[m]=this.yy[m]);y.setInput(t,d.yy),d.yy.lexer=y,d.yy.parser=this,"undefined"==typeof y.yylloc&&(y.yylloc={});var g=y.yylloc;s.push(g);var v=y.options&&y.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var x,_,w,b,k,M,I,S,E,A={};;){if(w=i[i.length-1],this.defaultActions[w]?b=this.defaultActions[w]:((null===x||"undefined"==typeof x)&&(x=e()),b=a[w]&&a[w][x]),"undefined"==typeof b||!b.length||!b[0]){var N="";E=[];for(M in a[w])this.terminals_[M]&&M>l&&E.push("'"+this.terminals_[M]+"'");N=y.showPosition?"Parse error on line "+(c+1)+":\n"+y.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[x]||x)+"'":"Parse error on line "+(c+1)+": Unexpected "+(x==f?"end of input":"'"+(this.terminals_[x]||x)+"'"),this.parseError(N,{text:y.match,token:this.terminals_[x]||x,line:y.yylineno,loc:g,expected:E})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+w+", token: "+x);switch(b[0]){case 1:i.push(x),r.push(y.yytext),s.push(y.yylloc),i.push(b[1]),x=null,_?(x=_,_=null):(u=y.yyleng,o=y.yytext,c=y.yylineno,g=y.yylloc,h>0&&h--);break;case 2:if(I=this.productions_[b[1]][1],A.$=r[r.length-I],A._$={first_line:s[s.length-(I||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(I||1)].first_column,last_column:s[s.length-1].last_column},v&&(A._$.range=[s[s.length-(I||1)].range[0],s[s.length-1].range[1]]),k=this.performAction.apply(A,[o,u,c,d.yy,b[1],r,s].concat(p)),"undefined"!=typeof k)return k;I&&(i=i.slice(0,-1*I*2),r=r.slice(0,-1*I),s=s.slice(0,-1*I)),i.push(this.productions_[b[1]][0]),r.push(A.$),s.push(A._$),S=a[i[i.length-2]][i[i.length-1]],i.push(S);break;case 3:return!0}}return!0}},c=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=t[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var s in r)this[s]=r[s];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length;s++)if(n=this._input.match(this.rules[r[s]]),n&&(!e||n[0].length>e[0].length)){if(e=n,i=s,this.options.backtrack_lexer){if(t=this.test_match(n,r[s]),t!==!1)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,r[i]),t!==!1?t:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,n,i){switch(n){case 0:return 11;case 1:return"(";case 2:return")";case 3:return 8;case 4:return 15;case 5:return 13;case 6:return 18;case 7:return 19;case 8:return 20;case 9:return 17;case 10:return 17;case 11:return 17;case 12:break;case 13:return 6}},rules:[/^(?:\/)/,/^(?:\()/,/^(?:\))/,/^(?:(\*|x|\u00d7|\u2219|\u22c5|\u00b7)\s*10\s*\^)/,/^(?:\^)/,/^(?:\*)/,/^(?:[0-9]+\.[0-9]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:\u00b0( ?)[cCfF])/,/^(?:fl\.? oz\.?)/,/^(?:[\u00b5]?([A-Za-z-]+|[\u2103\u2109\u212b]))/,/^(?:\s+)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return t}();return o.lexer=c,t.prototype=o,o.Parser=t,new t}();t.unitParser=e}(KAS),function(t){function e(){}function n(){}function i(){1===arguments.length?this.terms=arguments[0]:this.terms=_.toArray(arguments)}function r(){1===arguments.length?this.terms=arguments[0]:this.terms=_.toArray(arguments)}function s(t,e){this.base=t,this.exp=e}function a(t,e){this.base=t,this.power=e}function o(t,e){this.type=t,this.arg=e}function c(t){this.arg=t}function u(t,e,n){this.left=t,this.type=e,this.right=n}function h(){}function l(t,e){this.symbol=t,this.arg=e}function f(t,e){this.symbol=t,this.subscript=e}function p(t){this.symbol=t}function y(){}function d(t,e){var n=t,i=e;0>i&&(n=-n,i=-i),this.n=n,this.d=i}function m(t){this.n=t}function g(t){this.n=t}function v(t){this.symbol=t}var x=function(){throw new Error("Abstract method - must override for expr: "+this.print())},w=function(t){throw new Error(t)},b=function(t){return t!==t},k=function(t,e){var n=e-t;return Math.random()*n+t},M=12,I=9;_.extend(e.prototype,{func:x,args:x,construct:function(t){var e=new this.func;return this.func.apply(e,t),e},recurse:function(t){var e=Array.prototype.slice.call(arguments,1),n=_.map(this.args(),function(n){return _.isString(n)?n:n[t].apply(n,e)});return this.construct(n)},eval:x,codegen:x,compile:function(){var t=this.codegen();try{return new Function("vars","return "+t+";")}catch(e){throw new Error("Function did not compile: "+t)}},print:x,tex:x,asTex:function(t){t=t||{},_.defaults(t,{display:!0,dynamic:!0,times:!1});var e=this.tex();return t.display&&(e="\\displaystyle "+e),t.dynamic&&(e=e.replace(/\(/g,"\\left("),e=e.replace(/\)/g,"\\right)")),t.times&&(e=e.replace(/\\cdot/g,"\\times")),e},name:function(){return this.func.name?this.func.name:this.func.toString().match(/^function\s*([^\s(]+)/)[1]},repr:function(){return this.name()+"("+_.map(this.args(),function(t){return _.isString(t)?t:t.repr()}).join(",")+")"},strip:function(){return this.recurse("strip")},normalize:function(){return this.recurse("normalize")},expand:function(){return this.recurse("expand")},factor:function(t){return this.recurse("factor",t)},collect:function(t){return this.recurse("collect",t)},equals:function(t){return this.normalize().print()===t.normalize().print()},simplify:function(t){t=_.extend({once:!1},t);var e=this.factor(t),n=e.collect(t);e.equals(n)&&(n=this.collect(t));var i=n.expand(t),r=i.collect(t);i.equals(r)&&(r=n.collect(t));var s=r;return t.once||this.equals(s)?s:s.simplify(t)},isSimplified:function(){return this.equals(this.simplify())},exprArgs:function(){return _.filter(this.args(),function(t){return t instanceof e})},getVars:function(t){return _.uniq(_.flatten(_.invoke(this.exprArgs(),"getVars",t))).sort()},getUnits:function(){return _.flatten(_.invoke(this.exprArgs(),"getUnits"))},is:function(t){return this instanceof t},has:function(t){return this instanceof t?!0:_.any(this.exprArgs(),function(e){return e.has(t)})},raiseToThe:function(t){return new s(this,t)},isSubtract:function(){return!1},isDivide:function(){return!1},isRoot:function(){return!1},needsExplicitMul:function(){
return this.args()[0].needsExplicitMul()},sameVars:function(t){var e=this.getVars(),n=t.getVars(),i=function(t,e){return!_.difference(t,e).length},r=function(t){return _.uniq(_.invoke(t,"toLowerCase")).sort()},s=i(e,n),a=i(r(e),r(n));return{equal:s,equalIgnoringCase:a}},compare:function(t){if(t instanceof u)return!1;var e=_.union(this.getVars(!0),t.getVars(!0)),n=function(t,e){return Math.abs(t)<1||Math.abs(e)<1?Math.abs(t-e):Math.abs(1-t/e)},i=function(t,e){var i=n(t,e);return t===e||b(t)&&b(e)||i<Math.pow(10,-I)};if(!e.length&&!this.has(v)&&!t.has(v))return i(this.eval(),t.eval());var r=this.collect(),s=t.collect(),a=this.getUnits(),o=t.getUnits();if(!_.isEqual(a,o))return!1;for(var c=0;M>c;c++){var h={},f=Math.pow(10,1+Math.floor(3*c/M)),p=c%2===0;_.each(e,function(t){h[t]=p?k(-f,f):_.random(-f,f)});var y;if(r.has(l)||s.has(l)||r.has(v)||s.has(v)){var d=r.partialEval(h),m=s.partialEval(h);y=d.simplify().equals(m.simplify())}else{var d=r.eval(h),m=s.eval(h);y=i(d,m)}if(!y)return!1}return!0},partialEval:function(t){return this instanceof v?this:this.has(l)?this instanceof l?new l(this.symbol,this.arg.partialEval(t)):this.recurse("partialEval",t):new g(this.eval(t).toFixed(I)).collect()},sameForm:function(t){return this.strip().equals(t.strip())},findGCD:function(t){return this.equals(t)?t:y.One},getDenominator:function(){return y.One},asMul:function(){return new r(y.One,this)},isPositive:x,isNegative:function(){return!1},asPositiveFactor:function(){return this.isPositive()?this:y.One},addHint:function(t){if(!t)return this;var e=this.construct(this.args());return e.hints=_.clone(this.hints),e.hints[t]=!0,e},hints:{parens:!1},asExpr:function(){return this},completeParse:function(){return this.recurse("completeParse")},abs:x,negate:function(){return new r(y.Neg,this)}}),n.prototype=new e,_.extend(n.prototype,{args:function(){return this.terms},normalize:function(){var t=_.sortBy(_.invoke(this.terms,"normalize"),function(t){return t.print()});return new this.func(t)},expand:function(){return this.recurse("expand").flatten()},partition:function(){var t=_.groupBy(this.terms,function(t){return t instanceof y}),e=t[!0]||[],n=t[!1]||[];return[new this.func(e),new this.func(n)]},flatten:function(){var t=this,e=_.reject(this.terms,function(e){return e.equals(t.identity)});if(0===e.length)return t.identity;if(1===e.length)return e[0];var n=_.groupBy(e,function(e){return e instanceof t.func}),i=n[!0]||[],r=n[!1]||[],s=r.concat(_.flatten(_.pluck(i,"terms"),!0));return new t.func(s)},identity:void 0,reduce:x,isPositive:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isPositive"))},replace:function(t,n){var i;i=t instanceof e?_.indexOf(this.terms,t):t;var r=[];_.isArray(n)?r=n:n&&(r=[n]);var s=this.terms.slice(0,i).concat(r).concat(this.terms.slice(i+1));return new this.func(s)},remove:function(t){return this.replace(t)},getDenominator:function(){return new r(_.invoke(this.terms,"getDenominator")).flatten()}}),i.prototype=new n,_.extend(i.prototype,{func:i,eval:function(t,e){return _.reduce(this.terms,function(n,i){return n+i.eval(t,e)},0)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" + ")||"0"},print:function(){return _.invoke(this.terms,"print").join("+")},tex:function(){var t="";return _.each(this.terms,function(e){t+=!t||e.isSubtract()?e.tex():"+"+e.tex()}),t},collect:function(t){var e=_.invoke(this.terms,"collect",t),n=[];_.each(e,function(e){if(e instanceof r){var i=e.partition();n.push([i[1].flatten(),i[0].reduce(t)])}else e instanceof y?n.push([y.One,e]):n.push([e,y.One])});var s=_.groupBy(n,function(t){return t[0].normalize().print()}),a=_.compact(_.map(s,function(e){var n=e[0][0],s=new i(_.zip.apply(_,e)[1]),a=s.reduce(t);return new r(a,n).collect(t)}));return new i(a).flatten()},factor:function(t){t=_.extend({keepNegative:!1},t);var e,n=_.invoke(this.terms,"collect");e=n[0]instanceof r?n[0].terms:[n[0]],_.each(_.rest(this.terms),function(t){e=_.map(e,function(e){return t.findGCD(e)})}),!t.keepNegative&&this.isNegative()&&e.push(y.Neg),e=new r(e).flatten().collect();var s=_.map(n,function(t){return r.handleDivide(t,e).simplify()});return s=new i(s).flatten(),r.createOrAppend(e,s).flatten()},reduce:function(t){return _.reduce(this.terms,function(e,n){return e.add(n,t)},this.identity)},needsExplicitMul:function(){return!1},isNegative:function(){var t=_.invoke(this.terms,"collect");return _.all(_.invoke(t,"isNegative"))},negate:function(){return new i(_.invoke(this.terms,"negate"))}}),r.prototype=new n,_.extend(r.prototype,{func:r,eval:function(t,e){return _.reduce(this.terms,function(n,i){return n*i.eval(t,e)},1)},codegen:function(){return _.map(this.terms,function(t){return"("+t.codegen()+")"}).join(" * ")||"0"},print:function(){return _.map(this.terms,function(t){return t instanceof i?"("+t.print()+")":t.print()}).join("*")},getUnits:function(){var t=_(this.terms).chain().map(function(t){return t.getUnits()}).flatten().value();return t.sort(function(t,e){return t.unit<e.unit}),t},tex:function(){for(var t,e=" \\cdot ",n=_.groupBy(this.terms,function(t){return t.isDivide()?"inverse":t instanceof y?"number":"other"}),a=n.inverse||[],o=n.number||[],c=n.other||[],u="",h=0;h<o.length;h++){var l=o[h]instanceof d&&!(o[h]instanceof m);if(l&&c.length>0&&a.length>0){var f=o.slice();f.splice(h,1);var p=f.concat(a).concat(c);return o[h].tex()+new r(p).tex()}}if(o=_.compact(_.map(o,function(t){var e=t instanceof d&&!(t instanceof m),n=!t.hints.fraction||a.length>0;if(e&&n){a.push(new s(new m(t.d),y.Div));var i=new m(t.n);return i.hints=t.hints,_.any(t.hints)?i:null}return t})),0===o.length&&1===c.length)t=c[0].tex();else{var g="";_.each(o,function(t){t.hints.subtract&&t.hints.entered?(u+="-",g+=(g?e:"")+t.abs().tex()):t instanceof m&&-1===t.n&&(t.hints.negate||t.hints.subtract)?u+="-":g+=(g?e:"")+t.tex()}),_.each(c,function(t){g+=t.needsExplicitMul()?(g?e:"")+t.tex():t instanceof i?"("+t.tex()+")":t.tex()}),t=g?g:"1"}if(a.length){var v=new r(_.invoke(a,"asDivide")).flatten().tex();return u+"\\frac{"+t+"}{"+v+"}"}return u+t},strip:function(){var t=_.map(this.terms,function(t){return t instanceof y?t.abs():t.strip()});return new r(t).flatten()},expand:function(){var t=function(t){return t instanceof i},e=function(t){return t instanceof s&&t.exp.isNegative()},n=function(n){return e(n)&&t(n.base)},a=this.recurse("expand").flatten(),o=_.any(a.terms,t),c=_.any(a.terms,n);if(!o&&!c)return a;var u=_.groupBy(a.terms,e),h=u[!1]||[],l=u[!0]||[];if(o){var f=_.groupBy(h,t),p=f[!0]||[],d=f[!1]||[],m=_.reduce(p,function(t,e){return _.reduce(t,function(t,n){return t.concat(_.map(e.terms,function(t){return n.concat(t)}))},[])},[[]]),g=_.map(m,function(t){return new r(d.concat(t)).flatten()});h=[new i(g)]}if(c){var v=new r(_.invoke(l,"getDenominator")).flatten();l=[new s(v.expand(),y.Div)]}return new r(h.concat(l)).flatten()},factor:function(t){var e=this.recurse("factor",t).flatten();if(!(e instanceof r))return e;var n=_.groupBy(e.terms,function(t){return t instanceof d}),i=_.reduce(n[!0],function(t,e){return{n:t.n*e.n,d:t.d*e.d}},{n:1,d:1});return i=1===i.d?new m(i.n):new d(i.n,i.d),new r((n[!1]||[]).concat(i)).flatten()},collect:function(t){var e=this.recurse("collect",t).partition(),n=e[0].reduce(t);if(0===n.eval())return y.Zero;var c=e[1].flatten();if(!(c instanceof r))return new r(n,c).flatten();c=c.terms;var u=[];_.each(c,function(t){t instanceof s?u.push([t.base,t.exp]):u.push([t,y.One])});var h=_.groupBy(u,function(t){return t[0].normalize().print()}),l=_.compact(_.map(h,function(e){var n=e[0][0],r=new i(_.zip.apply(_,e)[1]),s=r.collect(t);return s instanceof y&&0===s.eval()?null:[n,s]})),u=_.groupBy(l,function(t){return t[0]instanceof o&&t[0].isBasic()?"trig":t[0]instanceof a?"log":"expr"}),f=u.trig||[],p=u.log||[],d=u.expr||[];if(f.length>1){var m=_.groupBy(f,function(t){return t[0].arg.normalize().print()});f=[],_.each(m,function(e){var n=e[0][0].arg,i={sin:y.Zero,cos:y.Zero};_.each(e,function(t){i[t[0].type]=t[1]}),r.handleNegative(i.sin).collect(t).equals(i.cos)&&(i=i.cos.isNegative()?{tan:i.sin}:{cot:i.cos}),_.each(i,function(t,e){f.push([new o(e,n),t])})})}if(p.length>1){var g=_.groupBy(p,function(t){return t[0].base.normalize().print()});p=[],_.each(g,function(e){2===e.length&&r.handleNegative(e[0][1]).collect(t).equals(e[1][1])?e[0][1].isNegative()?p.push([new a(e[0][0].power,e[1][0].power),e[1][1]]):p.push([new a(e[1][0].power,e[0][0].power),e[0][1]]):p=p.concat(e)})}u=f.concat(p).concat(d);var v=_.map(u,function(e){return new s(e[0],e[1]).collect(t)});return new r([n].concat(v)).flatten()},isSubtract:function(){return _.any(this.terms,function(t){return t instanceof y&&t.hints.subtract})},factorIn:function(t){var e=this.partition(),n=e[0].terms,i=n.length&&_.all(n,function(t){return t.n>0});if(i){var s=n[0].negate();return s.hints=n[0].hints,this.replace(n[0],s.addHint(t))}return new r([y.negativeOne(t)].concat(this.terms))},factorOut:function(){var t=!1,e=_.compact(_.map(this.terms,function(e,n,i){return!t&&e instanceof y&&e.hints.divide?(t=!0,-1!==e.n?e.negate():null):e}));return 1===e.length?e[0]:new r(e)},reduce:function(t){return _.reduce(this.terms,function(e,n){return e.mul(n,t)},this.identity)},findGCD:function(t){return new r(_.invoke(this.terms,"findGCD",t)).flatten()},asMul:function(){return this},asPositiveFactor:function(){if(this.isPositive())return this;var t=_.invoke(this.collect().terms,"asPositiveFactor");return new r(t).flatten()},isNegative:function(){return _.any(_.invoke(this.collect().terms,"isNegative"))},fold:function(){return r.fold(this)},negate:function(){var t=function(t){return t instanceof y};if(_.any(this.terms,t)){var e=_.find(this.terms,t);return this.replace(e,e.negate())}return new r([y.Neg].concat(this.terms))}}),_.each([i,r],function(t){_.extend(t,{createOrAppend:function(e,n){return e instanceof t?new t(e.terms.concat(n)):new t(e,n)}})}),_.extend(r,{handleNegative:function(t,e){if(t instanceof y&&t.n>0){var n=t.negate();return n.hints=t.hints,n.addHint(e)}return t instanceof r?t.factorIn(e):new r(y.negativeOne(e),t)},handleDivide:function(t,e){if(e instanceof r){var n=r.handleDivide(t,e.terms[0]),i=new r(_.rest(e.terms)).flatten();return r.handleDivide(n,i)}var a=function(t){return t instanceof m},c=function(t){return t instanceof d};if(a(e)&&t instanceof r&&_.any(t.terms,a)){var u=t.terms.slice().reverse(),h=_.find(u,c);if(!a(h))return new r(t.terms.concat([new d(1,e.n).addHint("fraction")]));var l=new d(h.n,e.n);l.hints=h.hints,h===u[0]&&(l=l.addHint("fraction"));return h.n<0&&e.n<0?(l.d=-l.d,t.replace(h,[y.Neg,l])):t.replace(h,l)}var f=function(t,e){if(e instanceof m){if(t instanceof m)return t.n<0&&e.n<0?[y.Neg,new d(t.n,-e.n).addHint("fraction")]:[new d(t.n,e.n).addHint("fraction")];var n=new d(1,e.eval());return e.eval()<0?[t,n.addHint("negate")]:[t,n]}var i;if(e instanceof o&&e.exp){var a=e.exp;e.exp=void 0,e=new s(e,a)}return i=e instanceof s?new s(e.base,r.handleNegative(e.exp,"divide")):new s(e,y.Div),t instanceof m&&1===t.n?[i]:[t,i]};if(t instanceof r){var p=f(_.last(t.terms),e);return new r(_.initial(t.terms).concat(p))}var p=f(t,e);return new r(p).flatten()},fold:function(t){if(t instanceof r){var e=_.find(_.initial(t.terms),function(t){return(t instanceof o||t instanceof a)&&t.hints.open}),n=_.indexOf(t.terms,e);if(e){var i=_.last(t.terms);if(!(e.hints.parens||i.hints.parens||i.has(o)||i.has(a))){var s;return s=e instanceof o?o.create([e.type,e.exp],r.createOrAppend(e.arg,i).fold()):a.create(e.base,r.createOrAppend(e.power,i).fold()),0===n?s:new r(t.terms.slice(0,n).concat(s)).fold()}e.hints.open=!1}var c=t.partition(),u=c[0].terms,h=function(t){return t.n>0},l=function(t){return-1===t.n&&t.hints.negate},f=function(t){return h(t)||l(t)};if(u.length>1&&_.some(u,l)&&_.some(u,h)&&_.every(u,f)){var p=_.indexOf(t.terms,_.find(t.terms,l)),y=_.indexOf(t.terms,_.find(t.terms,h));if(y>p)return t.replace(y,t.terms[y].negate()).remove(p)}}return t}}),s.prototype=new e,_.extend(s.prototype,{func:s,args:function(){return[this.base,this.exp]},eval:function(t,e){var n=this.base.eval(t,e),i=this.exp.eval(t,e);if(0>n){var r=this.exp.simplify();if(r instanceof d){var s=Math.abs(r.d)%2===1;if(s){var a=Math.abs(r.n)%2===1,o=a?-1:1;return o*Math.pow(-1*n,i)}}}return Math.pow(n,i)},getUnits:function(){return this.base.getUnits().map(function(t){return{unit:t.unit,pow:t.pow*this.exp.n}}.bind(this))},codegen:function(){return"Math.pow("+this.base.codegen()+", "+this.exp.codegen()+")"},print:function(){var t=this.base.print();return(this.base instanceof n||this.base instanceof s)&&(t="("+t+")"),t+"^("+this.exp.print()+")"},tex:function(){if(this.isDivide())return"\\frac{1}{"+this.asDivide().tex()+"}";if(this.isRoot())return 1!==this.exp.n&&w("Node marked with hint 'root' does not have exponent of form 1/x."),2===this.exp.d?"\\sqrt{"+this.base.tex()+"}":"\\sqrt["+this.exp.d+"]{"+this.base.tex()+"}";if(this.base instanceof o&&!this.base.isInverse()&&this.exp instanceof y&&this.exp.isSimple()&&this.exp.eval()>=0){var t=this.base.tex({split:!0});return t[0]+"^{"+this.exp.tex()+"}"+t[1]}var e=this.base.tex();return this.base instanceof n||this.base instanceof s||this.base instanceof y&&!this.base.isSimple()?e="("+e+")":(this.base instanceof o||this.base instanceof a)&&(e="["+e+"]"),e+"^{"+this.exp.tex()+"}"},needsExplicitMul:function(){return this.isRoot()?!1:this.base.needsExplicitMul()},expand:function(){var t=this.recurse("expand");if(t.base instanceof r){var e=_.map(t.base.terms,function(e){return new s(e,t.exp)});return new r(e).expand()}if(t.base instanceof i&&t.exp instanceof m&&t.exp.abs().eval()>1){for(var n=t.exp.eval()>0,a=t.exp.abs().eval(),o=function(t){return n?t:new s(t,y.Div)},c={1:t.base},u=2;a>=u;u*=2){var h=new r(c[u/2],c[u/2]);c[u]=h.expand().collect()}if(_.has(c,a))return o(c[a]);var l=_.map(a.toString(2).split(""),function(t,e,n){return Number(t)*Math.pow(2,n.length-e-1)});l=_.without(l,0);var h=new r(_.pick(c,l)).expand().collect();return o(h)}if(t.exp instanceof i){var e=_.map(t.exp.terms,function(e){return new s(t.base,e).expand()});return new r(e).expand()}return t},factor:function(){var t=this.recurse("factor");if(t.base instanceof r){var e=_.map(t.base.terms,function(e){return e instanceof m&&t.exp.equals(y.Div)?new d(1,e.n):new s(e,t.exp)});return new r(e)}return t},collect:function(t){if(this.base instanceof s){var e=this.base.base,n=r.createOrAppend(this.base.exp,this.exp);return new s(e,n).collect(t)}var i=this.recurse("collect",t),o=function(t){return t instanceof a&&t.base.equals(i.base)};if(i.exp instanceof y&&0===i.exp.eval())return y.One;if(i.exp instanceof y&&1===i.exp.eval())return i.base;if(o(i.exp))return i.exp.power;if(i.exp instanceof r&&_.any(i.exp.terms,o)){var c=_.find(i.exp.terms,o),e=c.power,n=i.exp.remove(c).flatten();return new s(e,n).collect(t)}if(i.base instanceof y&&i.exp instanceof y){if(t&&t.preciseFloats){var n=i.exp.asRational(),u=i.base.getDecimalPlaces(),h=new s(i.base,new d(1,n.d)),l=h.collect().getDecimalPlaces();if(l>u){var f=new s(i.base,new m(n.n)).collect();return new s(f,new d(1,n.d))}}return i.base.raiseToThe(i.exp,t)}return i},isDivide:function(){var t=function(t){return t instanceof y&&t.hints.divide};return t(this.exp)||this.exp instanceof r&&_.any(this.exp.terms,t)},asDivide:function(){if(this.exp instanceof y){if(-1===this.exp.eval())return this.base;var t=this.exp.negate();return t.hints=_.clone(this.exp.hints),t.hints.divide=!1,new s(this.base,t)}return this.exp instanceof r?new s(this.base,this.exp.factorOut()):void w("called asDivide() on an Expr that wasn't a Num or Mul")},isRoot:function(){return this.exp instanceof d&&this.exp.hints.root},isSquaredTrig:function(){return this.base instanceof o&&!this.base.isInverse()&&this.exp instanceof y&&2===this.exp.eval()},getDenominator:function(){if(this.exp instanceof y&&-1===this.exp.eval())return r.createOrAppend(this.base,this.base.getDenominator()).flatten();if(this.exp.isNegative()){var t=new s(this.base,r.handleNegative(this.exp).collect());return r.createOrAppend(t,t.collect().getDenominator()).flatten()}return this.base instanceof y?new s(this.base.getDenominator(),this.exp).collect():y.One},findGCD:function(t){var e,n;if(t instanceof s?(e=t.base,n=t.exp):(e=t,n=y.One),this.base.equals(e)){if(this.exp.equals(n))return this;if(this.exp instanceof y&&n instanceof y)return new s(this.base,y.min(this.exp,n)).collect();if(this.exp instanceof y||n instanceof y)return y.One;var i=this.exp.asMul().partition(),a=n.asMul().partition();if(i[1].equals(a[1])){var o=y.min(i[0].reduce(),a[0].reduce()),c=new r(o,i[1].flatten()).flatten();return new s(e,c).collect()}}return y.One},isPositive:function(){if(this.base.isPositive())return!0;var t=this.exp.simplify();return t instanceof m&&t.eval()%2===0},asPositiveFactor:function(){if(this.isPositive())return this;var t=this.exp.simplify();if(t instanceof m){var e=t.eval();if(e>2)return new s(this.base,new m(e-1));if(-2>e)return new s(this.base,new m(e+1))}return y.One}}),_.extend(s,{sqrt:function(t){return new s(t,y.Sqrt)},nthroot:function(t,e){var n=r.fold(r.handleDivide(new m(1),e));return new s(t,n.addHint("root"))}}),a.prototype=new e,_.extend(a.prototype,{func:a,args:function(){return[this.base,this.power]},eval:function(t,e){return Math.log(this.power.eval(t,e))/Math.log(this.base.eval(t,e))},codegen:function(){return"(Math.log("+this.power.codegen()+") / Math.log("+this.base.codegen()+"))"},print:function(){var t="("+this.power.print()+")";return this.isNatural()?"ln"+t:"log_("+this.base.print()+") "+t},tex:function(){var t="("+this.power.tex()+")";return this.isNatural()?"\\ln"+t:"\\log_{"+this.base.tex()+"}"+t},collect:function(t){var e=this.recurse("collect",t);return e.power instanceof y&&1===e.power.eval()?y.Zero:e.base.equals(e.power)?y.One:e.power instanceof s&&e.power.base.equals(e.base)?e.power.exp:e},expand:function(){var t=this.recurse("expand");if(t.power instanceof r){var e=_.map(t.power.terms,function(e){return new a(t.base,e).expand()});return new i(e)}return t.power instanceof s?new r(t.power.exp,new a(t.base,t.power.base).expand()).flatten():t.isNatural()?t:r.handleDivide(new a(p.e,t.power),new a(p.e,t.base))},hints:_.extend(a.prototype.hints,{open:!1}),isPositive:function(){var t=this.collect();return t.base instanceof y&&t.power instanceof y?this.eval()>0:!1},needsExplicitMul:function(){return!1},isNatural:function(){return this.base.equals(p.e)}}),_.extend(a,{natural:function(){return p.e},common:function(){return y.Ten},create:function(t,e){var n=new a(t,e);return e.hints.parens||(n=n.addHint("open")),n}}),o.prototype=new e,_.extend(o.prototype,{func:o,args:function(){return[this.type,this.arg]},functions:{sin:{eval:Math.sin,codegen:"Math.sin((",tex:"\\sin",expand:function(){return this}},cos:{eval:Math.cos,codegen:"Math.cos((",tex:"\\cos",expand:function(){return this}},tan:{eval:Math.tan,codegen:"Math.tan((",tex:"\\tan",expand:function(){return r.handleDivide(o.sin(this.arg),o.cos(this.arg))}},csc:{eval:function(t){return 1/Math.sin(t)},codegen:"(1/Math.sin(",tex:"\\csc",expand:function(){return r.handleDivide(y.One,o.sin(this.arg))}},sec:{eval:function(t){return 1/Math.cos(t)},codegen:"(1/Math.cos(",tex:"\\sec",expand:function(){return r.handleDivide(y.One,o.cos(this.arg))}},cot:{eval:function(t){return 1/Math.tan(t)},codegen:"(1/Math.tan(",tex:"\\cot",expand:function(){return r.handleDivide(o.cos(this.arg),o.sin(this.arg))}},arcsin:{eval:Math.asin,codegen:"Math.asin((",tex:"\\arcsin"},arccos:{eval:Math.acos,codegen:"Math.acos((",tex:"\\arccos"},arctan:{eval:Math.atan,codegen:"Math.atan((",tex:"\\arctan"},arccsc:{eval:function(t){return Math.asin(1/t)},codegen:"Math.asin(1/(",tex:"\\operatorname{arccsc}"},arcsec:{eval:function(t){return Math.acos(1/t)},codegen:"Math.acos(1/(",tex:"\\operatorname{arcsec}"},arccot:{eval:function(t){return Math.atan(1/t)},codegen:"Math.atan(1/(",tex:"\\operatorname{arccot}"},sinh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / 2)"},tex:"\\sinh",expand:function(){return this}},cosh:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/2},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / 2)"},tex:"\\cosh",expand:function(){return this}},tanh:{eval:function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") - Math.exp(-("+t+"))) / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\tanh",expand:function(){return r.handleDivide(o.sinh(this.arg),o.cosh(this.arg))}},csch:{eval:function(t){return 2/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\csch",expand:function(){return r.handleDivide(y.One,o.sinh(this.arg))}},sech:{eval:function(t){return 2/(Math.exp(t)+Math.exp(-t))},codegen:function(t){return"(2 / (Math.exp("+t+") + Math.exp(-("+t+"))))"},tex:"\\sech",expand:function(){return r.handleDivide(y.One,o.cosh(this.arg))}},coth:{eval:function(t){return(Math.exp(t)+Math.exp(-t))/(Math.exp(t)-Math.exp(-t))},codegen:function(t){return"((Math.exp("+t+") + Math.exp(-("+t+"))) / (Math.exp("+t+") - Math.exp(-("+t+"))))"},tex:"\\coth",expand:function(){return r.handleDivide(o.cosh(this.arg),o.sinh(this.arg))}}},isEven:function(){return _.contains(["cos","sec"],this.type)},isInverse:function(){return 0===this.type.indexOf("arc")},isBasic:function(){return _.contains(["sin","cos"],this.type)},eval:function(t,e){var n=this.functions[this.type].eval,i=this.arg.eval(t,e);return n(i)},codegen:function(){var t=this.functions[this.type].codegen;if("function"==typeof t)return t(this.arg.codegen());if("string"==typeof t)return t+this.arg.codegen()+"))";throw new Error("codegen not implemented for "+this.type)},print:function(){return this.type+"("+this.arg.print()+")"},tex:function(t){var e=this.functions[this.type].tex,n="("+this.arg.tex()+")";return t&&t.split?[e,n]:e+n},hints:_.extend(o.prototype.hints,{open:!1}),isPositive:function(){var t=this.collect();return t.arg instanceof y?this.eval()>0:!1},completeParse:function(){if(this.exp){var t=new s(this,this.exp);return this.exp=void 0,t}return this},needsExplicitMul:function(){return!1},expand:function(){var t=this.recurse("expand");if(t.isInverse())return t;var e=t.functions[t.type].expand;return _.bind(e,t)()},collect:function(t){var e=this.recurse("collect",t);if(!e.isInverse()&&e.arg.isNegative()){var n;return n=e.arg instanceof y?e.arg.abs():r.handleDivide(e.arg,y.Neg).collect(t),e.isEven()?new o(e.type,n):new r(y.Neg,new o(e.type,n))}return e}}),_.extend(o,{create:function(t,e){var n=t[0],i=t[1];i&&i.equals(y.Neg)&&(n="arc"+n,i=void 0);var r=new o(n,e);return e.hints.parens||(r=r.addHint("open")),i&&(r.exp=i),r},sin:function(t){return new o("sin",t)},cos:function(t){return new o("cos",t)},sinh:function(t){return new o("sinh",t)},cosh:function(t){return new o("cosh",t)}}),c.prototype=new e,_.extend(c.prototype,{func:c,args:function(){return[this.arg]},eval:function(t,e){return Math.abs(this.arg.eval(t,e))},codegen:function(){return"Math.abs("+this.arg.codegen()+")"},print:function(){return"abs("+this.arg.print()+")"},tex:function(){return"\\left|"+this.arg.tex()+"\\right|"},collect:function(t){var e=this.recurse("collect",t);if(e.arg.isPositive())return e.arg;if(e.arg instanceof y)return e.arg.abs();if(e.arg instanceof r){var n=_.groupBy(e.arg.terms,function(t){return t.isPositive()?"positive":t instanceof y?"number":"other"}),i=n.positive.concat(_.invoke(n.number,"abs"));return n.other.length&&i.push(new c(new r(n.other).flatten())),new r(i).flatten()}return e},expand:function(){var t=this.recurse("expand");if(t.arg instanceof r){var e=_.map(t.arg.terms,function(t){return new c(t)});return new r(e)}return t},isPositive:function(){return!0}}),u.prototype=new e,_.extend(u.prototype,{func:u,args:function(){return[this.left,this.type,this.right]},needsExplicitMul:function(){return!1},print:function(){return this.left.print()+this.type+this.right.print()},signs:{"=":" = ","<":" < ",">":" > ","<>":" \\ne ","<=":" \\le ",">=":" \\ge "},tex:function(){return this.left.tex()+this.signs[this.type]+this.right.tex()},normalize:function(){var t=this.recurse("normalize");return _.contains([">",">="],t.type)?new u(t.right,t.type.replace(">","<"),t.left):t},asExpr:function(t){var e=function(t){return t instanceof y&&t.isSimple()&&0===t.eval()},n=[];this.left instanceof i?n=_.clone(this.left.terms):e(this.left)||(n=[this.left]),this.right instanceof i?n=n.concat(this.right.negate().terms):e(this.right)||n.push(this.right.negate());var s=!this.isEquality();n=_.invoke(n,"collect",{preciseFloats:!0});for(var a=0;a<n.length;a++){var o=n[a].getDenominator();s&&!o.isPositive()&&(o=o.asPositiveFactor()),o.equals(y.One)||(n=_.map(n,function(t){return r.createOrAppend(t,o).simplify({once:!0,preciseFloats:!0})}))}var c=new i(n).flatten();return t?c:this.divideThrough(c)},divideThrough:function(t){var e=!this.isEquality(),n=t.simplify({once:!0}),a=n.factor({keepNegative:e});if(!(a instanceof r))return t;var o=a.terms,c=function(t){return t instanceof i},u=function(t){return!!t.getVars().length},h=function(t){return t.equals(y.One)},l=_.groupBy(o,c),f=l[!0]||[],p=l[!1]||[];if(f.length&&this.isEquality())return new r(f).flatten();var d=p;f.length||(d=_.reject(d,u)),e&&(d=_.invoke(d,"asPositiveFactor")),d=_.reject(d,h),d=_.map(d,function(t){return new s(t,y.Div)});var m=new r(o.concat(d)).collect();return m.equals(a)?n:m},isEquality:function(){return _.contains(["=","<>"],this.type)},compare:function(t){if(!(t instanceof u))return!1;var e=this.normalize(),n=t.normalize();if(e.type!==n.type)return!1;var i=e.divideThrough(e.asExpr(!0).collect()),s=n.divideThrough(n.asExpr(!0).collect());return e.isEquality()?i.compare(s)||i.compare(r.handleNegative(s)):i.compare(s)},sameForm:function(t){var e=this.normalize(),n=t.normalize(),i=e.left.sameForm(n.left)&&e.right.sameForm(n.right);return e.isEquality()?i||e.left.sameForm(n.right)&&e.right.sameForm(n.left):i},isSimplified:function(){var t=this.asExpr(!0),e=this.divideThrough(t).simplify();return t.equals(e)&&this.left.isSimplified()&&this.right.isSimplified()}}),_.extend(u.prototype,{solveLinearEquationForVariable:function(t){var e=this.asExpr();if(!e.is(i)||2!==e.terms.length)throw new Error("Can only handle linear equations of the form a + bx (= 0)");var n,s,a=function(e){return e.has(f)&&_.contains(e.getVars(),t.symbol)};return a(e.terms[0])?(n=r.handleNegative(e.terms[1]),s=r.handleDivide(e.terms[0],t)):(n=r.handleNegative(e.terms[0]),s=r.handleDivide(e.terms[1],t)),r.handleDivide(n,s).simplify()}}),h.prototype=new e,_.extend(h.prototype,{needsExplicitMul:function(){return!1},findGCD:function(t){return t instanceof h||t instanceof y?this.equals(t)?this:y.One:t.findGCD(this)}}),l.prototype=new h,_.extend(l.prototype,{func:l,args:function(){return[this.symbol,this.arg]},print:function(){return this.symbol+"("+this.arg.print()+")"},tex:function(){return this.symbol+"("+this.arg.tex()+")"},eval:function(e,n){var i=this.arg,r=e[this.symbol],s=_.extend(_.clone(e),{x:i.eval(e,n)}),a=t.parse(r,n);return a.parsed?a.expr.eval(s,n):a},codegen:function(){return'vars["'+this.symbol+'"]('+this.arg.codegen()+")"},getUnits:function(){return this.arg.getUnits()},getVars:function(t){return t?this.arg.getVars():_.union(this.arg.getVars(),[this.symbol]).sort()}}),f.prototype=new h,_.extend(f.prototype,{func:f,args:function(){return[this.symbol,this.subscript]},exprArgs:function(){return[]},recurse:function(){return this},print:function(){var t="";return this.subscript&&(t="_("+this.subscript.print()+")"),this.symbol+t},prettyPrint:function(){var t=this.subscript;return t&&(t instanceof y||t instanceof h)?this.symbol+"_"+t.print():this.print()},tex:function(){var t="";this.subscript&&(t="_{"+this.subscript.tex()+"}");var e=this.symbol.length>1?"\\":"";return e+this.symbol+t},repr:function(){return"Var("+this.print()+")"},eval:function(t,e){return t[this.prettyPrint()]},codegen:function(){return'vars["'+this.prettyPrint()+'"]'},getVars:function(){return[this.prettyPrint()]},isPositive:function(){return!1}}),p.prototype=new h,_.extend(p.prototype,{func:p,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,e){return"pi"===this.symbol?Math.PI:"e"===this.symbol?Math.E:void 0},codegen:function(){return"pi"===this.symbol?"Math.PI":"e"===this.symbol?"Math.E":void 0},print:function(){return this.symbol},tex:function(){return"pi"===this.symbol?"\\pi ":"e"===this.symbol?"e":void 0},isPositive:function(){return this.eval()>0},abs:function(){return this.eval()>0?this:r.handleNegative(this)}}),p.e=new p("e"),p.pi=new p("pi"),y.prototype=new e,_.extend(y.prototype,{repr:function(){return this.print()},strip:function(){return this.abs()},recurse:function(){return this},codegen:function(){return this.print()},add:x,mul:x,negate:x,isSubtract:function(){return this.hints.subtract},abs:x,needsExplicitMul:function(){return!0},findGCD:x,isPositive:function(){return this.eval()>0},isNegative:function(){return this.eval()<0},asPositiveFactor:function(){return this.isPositive()?this:this.abs()},hints:_.extend(y.prototype.hints,{negate:!1,subtract:!1,divide:!1,root:!1,fraction:!1,entered:!1}),isSimple:x,getDecimalPlaces:function(){var t=(""+this.n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},asRational:x}),d.prototype=new y,_.extend(d.prototype,{func:d,args:function(){return[this.n,this.d]},eval:function(){return this.n/this.d},print:function(){return this.n.toString()+"/"+this.d.toString()},tex:function(){var t="\\frac{"+Math.abs(this.n).toString()+"}{"+this.d.toString()+"}";return this.n<0?"-"+t:t},add:function(t,e){return t instanceof d?new d(this.n*t.d+this.d*t.n,this.d*t.d).collect():t.add(this,e)},mul:function(t,e){return t instanceof d?new d(this.n*t.n,this.d*t.d).collect():t.mul(this,e)},collect:function(){var t=y.findGCD(this.n,this.d),e=this.n/t,n=this.d/t;return 1===n?new m(e):new d(e,n)},negate:function(){return new d(-this.n,this.d)},abs:function(){return new d(Math.abs(this.n),this.d)},findGCD:function(t){if(t instanceof d){var e=y.findGCD(this.n*t.d,t.n*this.d),n=this.d*t.d;return new d(e,n).collect()}return t instanceof m?new d(y.findGCD(this.n,t.n),this.d):t.findGCD(this)},raiseToThe:function(t){if(t instanceof m){var e=t.eval()>0,n=t.abs().eval(),i=Math.pow(this.n,n),r=Math.pow(this.d,n);return e?new d(i,r).collect():new d(r,i).collect()}return new g(this.eval()).raiseToThe(t)},getDenominator:function(){return new m(this.d)},isSimple:function(){return!1},asRational:function(){return this}}),m.prototype=new d(0,1),_.extend(m.prototype,{func:m,args:function(){return[this.n]},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},negate:function(){return new m(-this.n)},abs:function(){return new m(Math.abs(this.n))},isSimple:function(){return!0},findGCD:function(t){return t instanceof m?new m(y.findGCD(this.n,t.n)):t.findGCD(this)}}),_.extend(m,{create:function(t){return new m(t).addHint("entered")}}),g.prototype=new y,_.extend(g.prototype,{func:g,args:function(){return[this.n]},eval:function(){return this.n},print:function(){return this.n.toString()},tex:function(){return this.n.toString()},add:function(t,e){return e&&e.preciseFloats?g.toDecimalPlaces(this.n+t.eval(),Math.max(this.getDecimalPlaces(),t.getDecimalPlaces())):new g(this.n+t.eval()).collect()},mul:function(t,e){return e&&e.preciseFloats?g.toDecimalPlaces(this.n*t.eval(),this.getDecimalPlaces()+t.getDecimalPlaces()):new g(this.n*t.eval()).collect()},collect:function(){return this},negate:function(){return new g(-this.n)},abs:function(){return new g(Math.abs(this.n))},findGCD:function(t){return t instanceof y?new g(y.findGCD(this.eval(),t.eval())).collect():t.findGCD(this)},raiseToThe:function(t,e){return e&&e.preciseFloats&&t instanceof m&&t.n>1?g.toDecimalPlaces(new s(this,t).eval(),this.getDecimalPlaces()*t.n):new g(new s(this,t).eval()).collect();
},asRational:function(){var t=this.n.toString().split(".");if(1===t.length)return new d(this.n,1);var e=Number(t.join("")),n=Math.pow(10,t[1].length);return new d(e,n).collect()},getDenominator:function(){return this.asRational().getDenominator()},isSimple:function(){return!0}}),_.extend(g,{create:function(t){return new g(t).addHint("entered")},toDecimalPlaces:function(t,e){return new g(+t.toFixed(Math.min(e,20))).collect()}}),_.extend(y,{negativeOne:function(t){return"subtract"===t?y.Sub:"divide"===t?y.Div:y.Neg},findGCD:function(t,e){var n;if(t=Math.abs(t),e=Math.abs(e),t!==Math.floor(t)||e!==Math.floor(e))return 1;for(;e;)n=t%e,t=e,e=n;return t},min:function(){return _.min(_.toArray(arguments),function(t){return t.eval()})},max:function(){return _.max(_.toArray(arguments),function(t){return t.eval()})}}),y.Neg=new m(-1).addHint("negate"),y.Sub=new m(-1).addHint("subtract"),y.Div=new m(-1).addHint("divide"),y.Sqrt=new d(1,2).addHint("root"),y.Zero=new m(0),y.One=new m(1),y.Ten=new m(10),i.prototype.identity=y.Zero,r.prototype.identity=y.One;var S=t.parser,E=function(t,e){throw new Error(e.loc.first_column)};S.yy={Add:i,Mul:r,Pow:s,Log:a,Trig:o,Eq:u,Abs:c,Func:l,Const:p,Var:f,Int:m,Float:g,parseError:E,constants:["e"],symbolLexer:function(t){return _.contains(S.yy.constants,t)?"CONST":_.contains(S.yy.functions,t)?"FUNC":"VAR"}},t.parse=function(t,e){try{e&&e.functions?S.yy.functions=_.without(e.functions,"i"):S.yy.functions=[],e&&e.decimal_separator&&(t=t.split(e.decimal_separator).join("."));var n=S.parse(t).completeParse();return{parsed:!0,expr:n}}catch(i){return{parsed:!1,error:i.message}}},v.prototype=new h;var A=function(t){if(_(N).has(t)||_(q).has(t))return new v(t);var e=_(_(T).keys()).find(function(e){return new RegExp("^"+e).test(t)});if(e){var n=t.replace(new RegExp("^"+e),"");if(_(N).has(n)||q[n]&&q[n].prefixes===D)return new r(T[e],new v(n));throw new Error(n+" does not allow prefixes")}return new v(t)};t.unitParse=function(e){try{var n=t.unitParser.parse(e),i=[];_(n.unit.num).each(function(t){i.push(new s(A(t.name),new m(t.pow)))}),_(n.unit.denom).each(function(t){i.push(new s(A(t.name),new m(-1*t.pow)))});var a=new r(i).flatten();if("unitMagnitude"===n.type){var o=[new g(+n.magnitude)].concat(i),c=new r(o);return{parsed:!0,unit:a,expr:c,coefficient:n.magnitude,type:n.type}}return{parsed:!0,unit:a,type:n.type}}catch(u){return{parsed:!1,error:u.message}}},_.extend(v.prototype,{func:v,args:function(){return[this.symbol]},recurse:function(){return this},eval:function(t,e){return 1},getUnits:function(){return[{unit:this.symbol,pow:1}]},codegen:function(){return"1"},print:function(){return this.symbol},tex:function(){return this.symbol},collect:function(t){if(_(N).has(this.symbol))return this;if(_(q).has(this.symbol))return q[this.symbol].conversion;throw new Error("could not understand unit: "+this.symbol)}});var N={m:new v("m"),g:new v("g"),s:new v("s"),A:new v("A"),K:new v("K"),mol:new v("mol"),cd:new v("cd")},T={a:new s(new m(10),new m(-18)),f:new s(new m(10),new m(-15)),p:new s(new m(10),new m(-12)),n:new s(new m(10),new m(-9)),u:new s(new m(10),new m(-6)),m:new s(new m(10),new m(-3)),c:new s(new m(10),new m(-2)),d:new s(new m(10),new m(-1)),da:new m(10),h:new s(new m(10),new m(2)),k:new s(new m(10),new m(3)),M:new s(new m(10),new m(6)),G:new s(new m(10),new m(9)),T:new s(new m(10),new m(12)),P:new s(new m(10),new m(15)),E:new s(new m(10),new m(18)),hella:new s(new m(10),new m(27))},D={},P={},O=function(e,n){var i=e.split("|"),a=i[0].trim(),o=i[1].trim(),c=y.One;""!==a&&(c=t.parse(a).expr);var u=o.split("/"),h=[c];return u[0]&&u[0].split(" ").filter(function(t){return""!==t}).map(function(t){h.push(new v(t))}),u[1]&&u[1].split(" ").filter(function(t){return""!==t}).map(function(t){h.push(new s(new v(t),y.Div))}),{conversion:new r(h),prefixes:n}},q={Da:O("1.6605388628 x 10^-24 | g",D),u:O("| Da",P),meter:O("| m",P),meters:O("| m",P),"in":O("254 / 10000 | m",P),ft:O("3048  / 10000 | m",P),yd:O("9144  / 10000 | m",P),mi:O("1609344 / 1000 | m",P),ly:O("9.4607 x 10^15 | m",P),nmi:O("1852 | m",P),"Å":O("10^-10 | m",P),pc:O("3.0857 x 10^16 | m",P),min:O("60 | s",P),hr:O("3600 | s",P),sec:O("| s",P),day:O("86400 | s",P),wk:O("604800 | s",P),fortnight:O("14 | day",P),shake:O("10^-8 | s",P),olympiad:O("126200000 | s",P),"°C":O("1 | K",P),"°F":O("5/9 | K",P),"°R":O("5/9 | K",P),e:O("1.6021765314 x 10^-19 | C",P),c:O("299792458 | m / s",P),kn:O("514/1000 | m / s",P),kt:O("| kn",P),knot:O("| kn",P),J:O("| N m",D),BTU:O("1060 | J",P),cal:O("4184 / 1000 | J",D),eV:O("1.602176514 x 10^-19 | J",D),erg:O("10^−7 | J",D),W:O("| J / s",D),"H-e":O("80 | W",P),N:O("1000 | g m / s s",D),lb:O("4448221615 / 1000000000 | N",P),dyn:O("10^-5 | N",P),Pa:O("1 | N / m m m",D),bar:O("10^5 | Pa",D),"㏔":O("1/1000 | bar",P),"㍴":O("| bar",P),atm:O("101325 | Pa",P),Torr:O("1/760 | atm",P),mmHg:O("| Torr",P),ha:O("10^4 | m m",P),b:O("10^−28 | m m",D),barn:O("| b",D),acre:O("4046.87 | m m",P),L:O("1/1000 | m m m",D),gal:O("3785/1000 | L",D),cup:O("1/16 | gal",P),qt:O("1/4 | gal",P),quart:O("| qt",P),p:O("1/8 | gal",P),pt:O("| p",P),pint:O("| p",P),"fl oz":O("1/8 | cup",P),"fl. oz.":O("1/8 | cup",P),tbsp:O("1/16 | cup",P),tsp:O("1/3 | tbsp",P),rev:O("2 pi | rad",P),deg:O("180 pi | rad",P),"°":O("| deg",P),arcminute:O("1/60 | deg",P),arcsec:O("1/3600 | deg",P),Hu:O("1000 | dB",D),dozen:O("12 |",P),mol:O("6.0221412927 x 10^23 |",D),"%":O("1/100 |",P),percent:O("| %",P),ppm:O("1/1000000 |",P),V:O("1000 | g m m / s s C",D),C:O("| A s",D),ampere:O("| A",P),"Ω":O("| V / A",D),ohm:O("| Ω",P),F:O("| C / V",D),H:O("| ohm s",D),T:O("1000 | g / C s",D),Wb:O("1000 | g m m / C s",D),b:O("10^−28 | m m",D),skilodge:O("10^-31 | m m",P),outhouse:O("10^-34 | m m",P),shed:O("10^-52 | m m",P),lm:O("pi x 10^4 | cd / m m",P),lx:O("| lm / m m",P),nit:O("| cd / m m",P),sb:O("10^4 | cd / m m",P),stilb:O("1 | sb",P),apostilb:O("1 / pi x 10^(-4) | sb",P),blondel:O("| apostilb",P),asb:O("| apostilb",P),la:O("| lm",P),Lb:O("| lm",P),sk:O("10^-7 | lm",P),skot:O("| sk",P),bril:O("10^-11 | lm",P),Hz:O("| / s",D)};t.Add=i,t.Mul=r,t.Pow=s,t.Log=a,t.Eq=u,t.Trig=o,t.Abs=c,t.Func=l,t.Var=f,t.Const=p,t.Unit=v,t.Rational=d,t.Int=m,t.Float=g,t.Zero=y.Zero,t.One=y.One}(KAS),function(t){t.compare=function(t,e,n){var i={form:!1,simplify:!1};n=void 0!==n?_.extend(i,n):i;var r=t.sameVars(e);if(!r.equal){var s=null;return r.equalIgnoringCase&&(s="Some of your variables are in the wrong case (upper vs. lower)."),{equal:!1,message:s}}return t.compare(e)?n.form&&!t.sameForm(e)?{equal:!1,message:"Your answer is not in the correct form."}:n.simplify&&!t.isSimplified()?{equal:!1,message:"Your answer is not fully expanded and simplified."}:{equal:!0,message:null}:{equal:!1,message:null}}}(KAS);
